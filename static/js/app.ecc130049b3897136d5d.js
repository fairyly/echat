webpackJsonp([1],[,,,,,,,,,,function(e,t,n){"use strict";var o=n(64),r=n.n(o),i={authDomain:"vechat.wilddogio.com",syncURL:"https://vechat.wilddogio.com"};r.a.initializeApp(i);var a=r.a.sync();t.a=a},,,,function(e,t,n){"use strict";var o=n(9),r=n(60),i=n(54),a=n.n(i),c=n(55),s=n.n(c);o.a.use(r.a),t.a=new r.a({routes:[{path:"/",name:"Login",component:a.a},{path:"/room",name:"Room",component:s.a}]})},function(e,t,n){n(42);var o=n(4)(n(18),n(58),null,null);e.exports=o.exports},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"app",data:function(){return{room:"",nickname:""}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={props:{stream:"",width:{type:Number,default:640},height:{type:Number,default:480}},computed:{src:function(){return this.stream?URL.createObjectURL(this.stream):""}},methods:{loadedmetadataHandler:function(){console.log("Label: "+this.stream.label),console.log("AudioTracks",this.stream.getAudioTracks()),console.log("VideoTracks",this.stream.getVideoTracks())}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(10);t.default={data:function(){return{nickname:"",room:""}},methods:{join:function(){var e=this;if(!this.room)return alert("亲~房间号！");var t=this.$root.$children[0],n=Math.random().toString(16).substr(2);t.nickname=n,t.room=this.room,o.a.child(this.room).child(n).set(Date.now(),function(t){t||e.$router.push({name:"Room"})})}}}},function(e,t,n){"use strict";function o(e){console.log(e)}Object.defineProperty(t,"__esModule",{value:!0});var r=n(24),i=n.n(r),a=n(22),c=n(10),s=n(53),l=n.n(s),u={iceServers:[{url:"stun:cn1-stun.wilddog.com:3478"}]};t.default={mixins:[a.a],data:function(){return this.dog=c.a,this.peer=null,{selfStream:null,userStream:null,targetNickname:""}},methods:{createLocalStream:function(){var e=this;return navigator.mediaDevices.getUserMedia({video:!0}).then(function(t){e.selfStream=t},function(e){console.log("GetUserMedia error: ",e)})},createPeer:function(e,t,n){var o=this;if(null==e)return console.log("set peer: cannot get local stream"),null;var r=new RTCPeerConnection(u);return this.peer=r,r.addStream(e,function(e){e&&console.log("setPeer: add stream error code: ",e)}),r.onaddstream=function(e){o.userStream=e.stream},r.onicecandidate=function(e){if(console.log("onicecandidate"),null!=e.candidate){var o={};o.from=n,o.type="candidate",o.value=i()(e.candidate),t.push(o)}},r},createOffer:function(e,t){var n=this;if(!this.peer)return void console.error("peer is null");this.peer.createOffer(function(r){n.peer.setLocalDescription(r,function(n){e.push({from:t,type:"offer",value:i()(r)})},o)},o)},broadcastOfferToRemote:function(){var e=this;this.dog.once("value",function(t){t.forEach(function(t){var n=t.key();if(n!==e.nickname){var o=e.dog.child(n).child("mailbox");e.createPeer(e.selfStream,o,e.nickname),e.createOffer(o,e.nickname)}})})},listenerSelfMailbox:function(){var e=this,t=this.dog,n=this.nickname,o=this.selfStream;t.child(n).child("mailbox").on("child_added",function(r){if(null!=r.val()){var i=r.child("from").val();e.targetNickname=i;var a=r.child("type").val();if("offer"==a){console.log("received offer");var c=JSON.parse(r.child("value").val()),s=t.child(i).child("mailbox");return void e.handleRemoteOffer(s,n,c,o)}if("answer"==a){var l=JSON.parse(r.child("value").val());return console.log("received answer"),void e.handleRemoteAnswer(l,i)}if("candidate"==a){console.log("received candidate");var u=new RTCIceCandidate(JSON.parse(r.child("value").val()));null!=e.peer&&e.peer.addIceCandidate(u)}}})},handleRemoteOffer:function(e,t,n,o){var r=this;this.createPeer(o,e,t);var a=new RTCSessionDescription(n);this.peer.setRemoteDescription(a,function(n){r.peer.createAnswer(function(n){r.peer.setLocalDescription(n,function(){var n={from:t,type:"answer",value:i()(r.peer.localDescription)};e.push(n)},function(e){console.log("setLocalDescription Failure callback: "+e)})},function(e){console.log("createAnswer Failure callback: "+e)})},function(e){console.log("setRemoteDescription Failure callback: "+e),r.peer._remoteState="failed"})},handleRemoteAnswer:function(e,t){if(null==this.peer)return void console.log("local peer is null!");var n=new RTCSessionDescription(e);this.peer.setRemoteDescription(n,function(){console.log("setRemoteDescription success")},function(e){console.log("setRemoteDescription err:",e)})},init:function(){this.broadcastOfferToRemote(),this.listenerSelfMailbox()}},created:function(){var e=this.nickname,t=this.room;if(!e||!t)return void this.$router.replace({name:"Login"});this.dog=c.a.child(t),this.dog.child(e).onDisconnect().remove(),this.dog.child(e).onDisconnect().remove(),this.createLocalStream().then(this.init)},components:{ChatView:l.a}}},function(e,t,n){"use strict";t.a={computed:{app:function(){return this.$root.$children[0]},nickname:function(){return this.app.nickname},room:function(){return this.app.room}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(9),r=n(15),i=n.n(r),a=n(14);o.a.config.productionTip=!1,new o.a({el:"#app",router:a.a,render:function(e){return e(i.a)}})},,,,,,,,,,,,,,,,,function(e,t){},function(e,t){},function(e,t){},function(e,t){},,,,,,,,,,function(e,t,n){n(43);var o=n(4)(n(19),n(59),null,null);e.exports=o.exports},function(e,t,n){n(40);var o=n(4)(n(20),n(56),null,null);e.exports=o.exports},function(e,t,n){n(41);var o=n(4)(n(21),n(57),null,null);e.exports=o.exports},function(e,t){e.exports={render:function(){var e=this,t=e.$createElement;return(e._self._c||t)("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.room,expression:"room",modifiers:{trim:!0}}],staticClass:"login-input",attrs:{type:"text",placeholder:"请输入房间号"},domProps:{value:e.room},on:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13))return null;e.join(t)},input:function(t){t.target.composing||(e.room=t.target.value.trim())},blur:function(t){e.$forceUpdate()}}})},staticRenderFns:[]}},function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("section",{staticClass:"page-room"},[n("div",{staticClass:"view-self"},[n("chat-view",{attrs:{stream:e.selfStream}}),e._v(" "),n("div",{staticClass:"info"},[n("span",[e._v("CHAT ROOM: "+e._s(e.room))]),e._v(" "),n("span",[e._v("NICKNAME: "+e._s(e.nickname))]),e._v(" "),n("span",[e._v("TARGET NICKNAME: "+e._s(e.targetNickname))])])],1),e._v(" "),n("div",{staticClass:"view-other"},[n("chat-view",{attrs:{stream:e.userStream}})],1)])},staticRenderFns:[]}},function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("router-view")],1)},staticRenderFns:[]}},function(e,t){e.exports={render:function(){var e=this,t=e.$createElement;return(e._self._c||t)("video",{staticClass:"component-chat-view",attrs:{autoplay:"",src:e.src,width:"width",height:"height"},on:{loadedmetadata:e.loadedmetadataHandler}})},staticRenderFns:[]}},,,,,,function(e,t){}],[23]);
//# sourceMappingURL=app.ecc130049b3897136d5d.js.map